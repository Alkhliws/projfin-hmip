% ----------------------------------------------------------------------- %
% Arquivo: cenarios.tex
% ----------------------------------------------------------------------- %

\chapter{Cenários de Testes}

\section{A Preparação dos Cenários}

\subsection{Cenários Estudados}
Após os estudos bibliográficos sobre o protocolo MIPv6 e a preparação da
Plataforma de Testes para Mobilidade, iniciou-se a etapa de definição e
implementação de cenários com fins de analisar algumas funcionalidade dos
protocolos instalados, demonstrando desta forma as potencialidades do ambiente
desenvolvido. 

Para analisar alguns mecanismos do protocolo e testar seus modos de operação,
dois cenários base foram definidos: cenário 1 com o MIPv6 e o cenário 2
com o HMIPv6. Para o primeiro cenário, duas variações foram realizadas. A
primeira, descrita na figura \ref{f_cenario1}, é testado o modo de operação por
tunelamento bi-direcional do MIPv6, sem a otimização de rota. A segunda variação
testa o modo de operação por otimização de roteamento. O cenário 2, descrito na
figura\ref{f_cenario2}, tem como objetivo verificar minimamente o
funcionamento do HMIPv6, em comunicações onde os nós correspondentes não
executam otimização de roteamento.

Os arquivos para a configuração dos cenários usados no Guml4Mip estão
disponíveis no diretório da documentação do projeto.

%Para auxiliar na geração de \textit{logs}, que tendem a enriquecer análise dos
%cenários, foram utilizadas as ferramentas
%\textit{tcpdump}, \textit{ping6} e \textit{gen}.

\section{Fundamentos para a Análise dos Cenários}
Na análise dos cenários estudados vamos localizar os seguintes aspectos:
\begin{itemize}
  \item a sequência e a natureza das mensagens trocadas entre os vários nós.
Neste aspecto, utilizaremos as saídas geradas pelos programas \textit{tcpdump};
  \item as tabelas de roteamento e as regras de roteamento analisadas em
situações chave, por exemplo, antes e depois da mobilidade;
  \item aspectos de desempenho e perdas de pacotes. Sabemos das limitações desta
análise em um ambiente virtual, mas esperamos obter dados relativos. Também
confrontaremos os dados obtidos com os resultados esperados segundo uma
abordagem analítica;
  \item A criação e a manipulação dos túneis entre o agente domiciliar e o nó
móvel antes e depois do movimento.
\end{itemize}

% \subsection{Considerações sobre o Tempo de latência do \textit{Handover}}
% O processo de \textit{handover} acontece quando o nó móvel muda seu ponto de
% conexão de uma sub-rede para outra. O tempo de latência envolvido neste processo
% \cite{xavier} pode ser dividida em quatro fases:
% 
% \begin{enumerate}
%  \item \textbf{Detecção de Movimento (\textit{TD})}: Em um cenário real
% representaria o tempo do \textit{handover} na camada de enlace até o primeiro
% \textit{Router Advertisement}. Como neste ambiente de testes não conseguimos
% simular a camada enlace não se pode precisar com a exatidão a latência envolvida
% no processo. Porém, para fins de estudo consideraremos para nosso cenário o
% tempo entre o último pacote do \textit{gen} recebido na rede domiciliar e o
% primeiro \textit{Router Advertisement} na rede visitada.
% 
% \begin{equation}
%  TD = t1 - t0
% \label{eq.td}
% \end{equation}
% 
% \item \textbf{Configuração do \textit{Care-of-address} (\textit{TA})}: Tempo que
% entre 
%  o primeiro \textit{Router Advertisement} e o envio do \textit{Binding Update}.
% 
% \begin{equation}
%  TA = t2 -t1
%  \label{eq.ta}
% \end{equation}
% 
% \item \textbf{Registro com agente domiciliar (\textit{TR})}: Intervalo de tempo
% entre
%  o envio do \textit{Binding Update} ao agente domiciliar e o recebimento do
%  \textit{Binding Acknowledgement}.
% 
% \begin{equation}
%  TR = t3 - t2
%  \label{eq.tr}
% \end{equation}
% 
% \item \textbf{Otimização de Roteamento (\textit{TO})}: Intervalo de tempo entre
% o envio das mensagens do \textit{Return Routability Procedure} e o recebimento
% do \textit{Binding Acknowledgement} do nó correspondente.
% 
% \begin{equation}
%  TO = t4 - t3
%  \label{eq.to}
% \end{equation}
% 
% \end{enumerate}
% 
% Obviamente podemos calcular o tempo de latência do handover com a seguinte
% fórmula:
% 
% \begin{equation}
%  TH = TD + TA + TR + TO
%  \label{eq.th}
% \end{equation}

\section{Cenário 1 - Uso do Protocolo MIPv6}
\label{s_cenario1}

\subsection{Descrição da Topologia}
O primeiro cenário de teste é formado por três redes interligadas entre si e
cinco nós. A sua topologia pode ser observada na figura \ref{f_cenario1}, onde o
numero nos balões cinza representam a vlan no \textit{uml-switch}. Os endereços
atribuídos as interfaces dos nós, durante a realização do cenário, bem como seus
endereços de hardware estão disponíveis na tabela \ref{t_addr1}.

\begin{figure}[!htpb]
	\centering
	\includegraphics[scale=.4]{figs/cenario1}
	\caption{Topologia do Cenário 1}
	\label{f_cenario1}
\end{figure}


Na rede com prefixo 2000:a::/64 está o nó correspondente com quem o nó móvel
está se comunicando. Na rede com o prefixo
 2000:c::/64 está presente um roteador (HA) que oferece o serviço de agente
domiciliar ao nó móvel. A rede com prefixo
 2000:d::/64 é a rede que o nó móvel deve visitar.

\begin{table}[!htpb]
\centering
\begin{small}
  \setlength{\tabcolsep}{3pt}
\begin{tabular}{|c|c|c|c|c||}\hline \hline
\textbf{Nó} & \textbf{Interface} & \textbf{MAC} &
\textbf{Endereço} & \textbf{Tipo}\\ \hline \hline

% MN
& & & 2001:c::2 & Domiciliar (Global) \\ 
MN & eth0 & fe:fd:32:ff:42:c9 & 2001:c::fcfd:32ff:feff:42c9 & Auto-configurado\\
& & & 2001:d::fcfd:32ff:feff:42c9 & Care-of-address \\
& & & fe80::fcfd:32ff:feff:42c9 & Local \\ \hline

% CN
CN & eth0 & fe:fd:65:34:8a:44 & 2001:a::2 & Global \\
& & & fe80::fcfd:65ff:fe34:8a44 & Local \\ \hline

% HA
& eth0 & fe:fd:b0:a2:9a:4c & 2001:b::2 & Global \\ 
HA & & & fe80::fcfd:b0ff:fea2:9a4c & Local \\
& eth1 & fe:fd:f5:49:32:bc & 2001:c::1 & Global \\ 
& & & fe80::fcfd:f5ff:fe49:32bc & Local \\ \hline

%AR1
& eth0 & fe:fd:0d:0c:a2:22 & 2001:b::1 & Global \\ 
AR1 & & & fe80::fcfd:dff:fe0c:a222 & Local \\ 
& eth1 & fe:fd:ee:57:0a:cd & 2001:a::1 & Global \\
& & & fe80::fcfd:eeff:fe57:acd & Local \\ \hline

%AR2
& eth0 & fe:fd:9f:3d:cf:8a & 2000:b::3 & Global \\ 
AR2 & & & fe80::fcfd:9fff:fe3d:cf8a & Local \\ 
& eth1 & fe:fd:71:bf:e3:e1 & 2000:d::1 & Global \\
& & & fe80::fcfd:71ff:febf:e3e1 & Local \\ \hline
\end{tabular} 
\end{small}
\caption{Endereços do Cenário 1}
\label{t_addr1}
\end{table} 

\subsection{Variação 1: com Tunelamento Bidirecional e Sem Otimização de Rota}

A simulação 1 terá a seguinte sequência. No início o nó correspondente começa a
enviar mensagens ICMP por meio do \textit{ping6} para o nó móvel.
%lstlisting
\begin{verbatim}
cn# ping6 2001:a::2
\end{verbatim}

O nó móvel realiza o monitoramento de todo o funcionamento do MIPv6 durante o
processo de \textit{handover} utilizando o \textit{tcpdump} em o modo
\textit{verbose} (-vvv) e para mostrar o conteúdo do pacote em hexadecimal (-X).

\begin{verbatim}
mn# tcpdump -vvvX
\end{verbatim}

\subsubsection{Análise da Troca de Mesagens}
Os dados obtidos na saída do comando \textit{tcpdump} foram compilados em forma
de uma tabela para facilitar a visualização dos mesmos e podem ser observados na
tabela \ref{t_resul_1}.
Analisando os dados recolhidos conseguimos observar o momento que o nó móvel
fez o movimento para a outra rede, no instante entre o echo reply seq 6 e o RA 
recebido do AR1.

\begin{table}[!htpb]
\centering
\begin{footnotesize}
  \setlength{\tabcolsep}{3pt}
\begin{tabular}{|c|c|c|c||}\hline \hline
\textbf{Tempo (s)} & \textbf{Origem} & \textbf{Destino} & \textbf{Conteúdo}\\ \hline \hline
19:50.348113 & fe80::fcfd:f5ff:fe49:32bc   & ff02::1                     & RA, Flags [home agent] \\
19:51.314075 & fe80::fcfd:f5ff:fe49:32bc   & ff02::1:ff00:2              & NS, who has 2001:c::2 \\
19:51.314229 & 2001:c::2                   & fe80::fcfd:f5ff:fe49:32bc   & neighbor advertisement \\
19:51.352652 & 2001:a::fcfd:65ff:fe34:8a44 & 2001:c::2                   & echo request, seq 6 \\
19:51.352733 & 2001:c::2                   & 2001:a::fcfd:65ff:fe34:8a44 & echo reply, seq 6 \\ \hline
\textbf{19:52.465459} & \textbf{fe80::fcfd:71ff:febf:e3e1} & \textbf{ff02::1} & \textbf{router advertisement} \\
19:52.481719 & ::                          & ff02::16                    & HBH, multicast listener\\
19:52.658194 & ::                          & ff02::1:ffff:42c9           & NS, who has (CoA - MN) \\
19:53.333508 & ::                          & ff02::1:ffff:42c9           & NS, who has (Local - MN) \\
\textbf{19:54.340614} & \textbf{2001:d::fcfd:32ff:feff:42c9} & \textbf{2001:c::1} & \textbf{BU seq\#=57619 AH} \\
19:54.457440 & fe80::fcfd:71ff:febf:e3e1   & ff02::1                     & router advertisement \\
19:55.370804 & fe80::fcfd:71ff:febf:e3e1   & ff02::1:ffff:42c9           & NS, who has (CoA - MN) \\
19:55.370970 & 2001:d::fcfd:32ff:feff:42c9 & fe80::fcfd:71ff:febf:e3e1   & neighbor advertisement \\
\textbf{19:55.372259} & \textbf{2001:c::1} & \textbf{2001:d::fcfd:32ff:feff:42c9} & \textbf{BA seq\#=57619} \\
19:55.405032 & 2001:c::1                   & 2001:d::fcfd:32ff:feff:42c9 & [src=2001:a::fcfd:65ff:fe34:8a44 \\
             &                             &                             & dst=2001:c::2] echo request \\
19:55.405184 & 2001:d::fcfd:32ff:feff:42c9 & 2001:c::1                   & [dst=2001:a::fcfd:65ff:fe34:8a44 \\
             &                             &                             & src=2001:c::2] echo reply \\
19:56.342799 & fe80::fcfd:32ff:feff:42c9   & fe80::fcfd:f5ff:fe49:32bc   & NS, who has (Local - HA) \\
19:56.417133 & 2001:c::1                   & 2001:d::fcfd:32ff:feff:42c9 & [src=2001:a::fcfd:65ff:fe34:8a44 \\
             &                             &                             & dst=2001:c::2] echo request \\
19:56.417254 & 2001:d::fcfd:32ff:feff:42c9 & 2001:c::1                   & [dst=2001:a::fcfd:65ff:fe34:8a44 \\
             &                             &                             & src=2001:c::2] echo reply] \\
19:56.601222 & fe80::fcfd:71ff:febf:e3e1   & ff02::1                     & router advertisement \\
.            & .                           & .                           & .\\
.            & .                           & .                           & .\\
.            & .                           & .                           & .\\
20:08.567634 & 2001:c::1                   & 2001:d::fcfd:32ff:feff:42c9 & [src=2001:a::fcfd:65ff:fe34:8a44 \\
             &                             &                             &  dst=2001:c::2:] echo request \\
20:08.567764 & 2001:d::fcfd:32ff:feff:42c9 & 2001:c::1                   & [dst=2001:a::fcfd:65ff:fe34:8a44 \\
             &                             &                             & src=2001:c::2] echo reply \\  \hline
\textbf{20:09.279849} & \textbf{fe80::fcfd:f5ff:fe49:32bc} & \textbf{ff02::1} & \textbf{RA, Flags [home agent]} \\
20:09.306449 & ::                          & ff02::16                    & HBH, multicast listener \\
20:09.331656 & ::                          & ff02::16                    & HBH, multicast listener \\
20:09.503149 & ::                          & ff02::1:ffff:42c9           & NS, who has (Auto) \\
20:09.545341 & ::                          & ff02::1:ffff:42c9           & NS, who has (Local) \\
20:09.676771 & ::                          & ff02::16                    & HBH, multicast listener\\
20:10.330373 & ::                          & ff02::16                    & HBH, multicast listener\\
20:10.543480 & ::                          & ff02::1:ff00:2              & NS, who has 2001:c::2 \\
20:10.564683 & fe80::fcfd:32ff:feff:42c9   & ff02::16                    & HBH, multicast listener\\
20:11.232774 & fe80::fcfd:f5ff:fe49:32bc   & ff02::1                     & neighbor advertisement \\
\textbf{20:11.236815} & \textbf{2001:c::2} & \textbf{2001:c::1}          & \textbf{BU seq\#=57620 AH} \\
20:11.259003 & fe80::fcfd:f5ff:fe49:32bc   & ff02::16                    & HBH, multicast listener\\
20:11.370555 & 2001:c::1                   & ff02::1:ff00:2              & NS, who has 2001:c::2 \\
20:11.370659 & 2001:c::2                   & 2001:c::1                   & neighbor advertisement \\
\textbf{20:11.370922} & \textbf{2001:c::1}          & \textbf{2001:c::2 }         & \textbf{BA seq\#=57620} \\
20:11.373667 & 2001:c::2                   & ff02::1                     & neighbor advertisement \\
20:11.598218 & 2001:a::fcfd:65ff:fe34:8a44 & 2001:c::2                   & echo request, seq 26 \\
20:11.598323 & 2001:c::2                   & 2001:a::fcfd:65ff:fe34:8a44 & echo reply, seq 26 \\
20:12.241584 & fe80::fcfd:f5ff:fe49:32bc   & ff02::1                     & router advertisement \\ \hline
\end{tabular} 
\end{footnotesize}
\caption{Mensagens do Cenário 1 com Tunelamento Bidirecional}
\label{t_resul_1}
\end{table} 

\subsubsection{Análise das Tabelas de Roteamento e de Regras de Roteamento}

Podemos constatar mudanças nas tabelas de roteamento do nó móvel e do agente
domiciliar depois da mobilidade nas respecitivas tabelas \ref{t_rot_mn1} e
\ref{t_rot_ha1}. Após o agente domiciliar receber o \textit{Binding Update},
é adicionada a seguinte rota a sua tabela de roteamento, que todos os 
pacotes com destino ao endereço domiciliar devem ser encaminhados para o túnel.
Após o nó móvel receber o \textit{Router Advertisement}, é alterada a rota
padrão, deletada a rota para rede 2001:c::/64 e adicionada uma rota para a rede 
2001:d::/64, onde a interface eth0 está atrelada.

\begin{table}[!htpb]
\centering
\begin{small}
  \setlength{\tabcolsep}{3pt}
\begin{tabular}{|c|c|c|c||}\hline \hline
\textbf{Destino} & \textbf{Via} & \textbf{Proximo
 salto} & \textbf{Considerações} \\ \hline \hline
2001:a::/64 &	eth0	&	fe80::fcfd:dff:fe0c:a222 & \\
2001:b::/64 &   eth0	&	::  & \\
\textbf{2001:c::2} & \textbf{eth1} & \textbf{2001:c::2}  & Antes da mobilidade do nó móvel\\
2001:c::/64 &	eth1	&	::  & \\
2001:d::/64 &	eth0	&	fe80::fcfd:9fff:fe3d:cf8a  & \\ \hline
2001:a::/64 &	eth0	&	fe80::fcfd:dff:fe0c:a222  & \\
2001:b::/64 &	eth0	&	::  & \\
\textbf{2001:c::2} & \textbf{ip6tnl1} & \textbf{2001:c::2} & Após a mobilidade do nó móvel \\
2001:c::/64 &	eth1	&	::  & \\
2001:d::/64 &	eth0	&	fe80::fcfd:9fff:fe3d:cf8a  & \\ \hline
\end{tabular}
\end{small}
\caption{Tabela principal de roteamento do agente domiciliar}
\label{t_rot_ha1}
\end{table}

\begin{table}[!htpb]
\centering
\begin{small}
  \setlength{\tabcolsep}{3pt}
\begin{tabular}{|c|c|c|c||}\hline \hline
\textbf{Destino} & \textbf{Via} & \textbf{Proximo
salto} & \textbf{Considerações}\\ \hline \hline
2001:c::2	          & ip6tnl1		  & :: &  \\
2001:c::/64               & eth0		  & :: & Na rede domiciliar \\
default	                  & eth0		  & fe80::fcfd:f5ff:fe49:32bc &
\\ \hline
2001:c::2	          & ip6tnl1		  & :: &  \\
2001:d::/64               & eth0		  & :: & Na rede visitada \\
default		          & eth0	          & fe80::fcfd:71ff:febf:e3e1 &
\\ \hline
\end{tabular} 
\end{small}
\caption{Tabela principal de roteamento do nó móvel}
\label{t_rot_mn1}
\end{table} 

Para que o nó móvel tenha os pacotes com destino ao nó correspondente e ao 
agente domiciliar encaminhados pelo túnel, o que caracteriza o tunelamento
bidirecional, é utilizado regras de roteamento, mostradas na tabela
\ref{t_rule_mn}.
As rotas da tabela 252 são mostradas na tabela \ref{t_route_252_mn}.

\begin{table}[!htpb]
\centering
\begin{small}
  \setlength{\tabcolsep}{3pt}
\begin{tabular}{|c|c|c||}\hline \hline
\textbf{Prioridade} & \textbf{Regra} & \textbf{Ação}
\\ \hline \hline
0:	& from all        &  lookup local \\
1001:	& from 2001:c::2  &  lookup 252 \\
1002:	& from fe80::/64 &   lookup main \\
1002:	& from 2001:d::/64 & lookup main \\
%1003:	& from 2001:c::2  &  blackhole\\
32766:	& from all        &  lookup main \\ \hline
\end{tabular} 
\end{small}
\caption{Regras de Roteamento do Nó movel}
\label{t_rule_mn}
\end{table} 

\begin{table}[!htpb]
\centering
\begin{small}
  \setlength{\tabcolsep}{3pt}
\begin{tabular}{|c|c|c||}\hline \hline
\textbf{Prioridade} & \textbf{Regra} & \textbf{Ação}
\\ \hline \hline
0:	& from all        &  lookup local \\
1005:	& from 2001:c::2  &  lookup 252 \\
32766:	& from all        &  lookup main \\ \hline
\end{tabular} 
\end{small}
\caption{Regras de Roteamento do Home Agente}
\label{t_rule_ha}
\end{table} 


\begin{table}[!htpb]
\centering
\begin{small}
  \setlength{\tabcolsep}{3pt}
\begin{tabular}{|c|c|c|c||}\hline \hline
\textbf{Destino} & \textbf{Via} & \textbf{Proximo
salto} & \textbf{Considerações}\\ \hline \hline
          *                 &   *     &     *     &  Na rede domiciliar\\ \hline
2001:a::fcfd:65ff:fe34:8a44 & ip6tnl1 & 2001:a::fcfd:65ff:fe34:8a44 & \\
2001:c::1                   & ip6tnl1 & 2001:c::1 &  Na rede visitada\\
default                     & ip6tnl1 & ::        & \\ \hline
\end{tabular} 
\end{small}
\caption{Tabela de Roteamento 252 do nó móvel}
\label{t_route_252_mn}
\end{table}

A tabela de Roteamento 252 do agente domiciliar, após o nó móvel realizar a 
mobilidade, é adicionada a seguinte regra.

\begin{verbatim}
2001:c::2 from 2001:c::1 dev eth1  proto 16  metric 128  mtu 1500 advmss 
  1440 hoplimit 4294967295
\end{verbatim}

\subsubsection{Detalhes da Formação de Túneis}
O tunel no nó móvel é criado antes de acontecer qualquer mobilidade. No agente
domiciliar o  túnel com o nó móvel é criado no recebimento do BU. As tabelas 
\ref{t_tun_ha1} e \ref{t_tun_mn1} apresentam o endereçamento do tunel, no HA e 
MN, antes e depois da mobilidade.

\begin{table}[!htpb]
\centering
\begin{small}
  \setlength{\tabcolsep}{3pt}
\begin{tabular}{|c|c|c|c|c||}\hline \hline
\textbf{Nome} & \textbf{Remoto} & \textbf{Local} & 
\textbf{Interface} & \textbf{Considerações} \\ \hline \hline
ip6tnl1 & 2001:c::1 & 2001:c::2 & eth0 & Antes da mobilidade do nó móvel \\
 \hline
ip6tnl1 & 2001:c::1 & 2001:d::fcfd:32ff:feff:42c9 & eth0 & Após a mobilidade do 
nó móvel \\ \hline
\end{tabular}
\end{small}
\caption{Descrição dos \texttt{end-points} do tunel do nó móvel}
\label{t_tun_mn1}
\end{table}

\begin{table}[!htpb]
\centering
\begin{small}
  \setlength{\tabcolsep}{3pt}
\begin{tabular}{|c|c|c|c|c||}\hline \hline
\textbf{Nome} & \textbf{Remoto} & \textbf{Local} & 
\textbf{Interface} & \textbf{Considerações} \\ \hline \hline
ip6tnl1 & :: & :: & eth0 & Antes da mobilidade do nó móvel \\ \hline
ip6tnl1 & 2001:d::fcfd:32ff:feff:42c9 & 2001:c::1 & eth0 & Após a mobilidade do 
nó móvel \\ \hline
\end{tabular}
\end{small}
\caption{Descrição dos \texttt{end-points} do tunel do agente domiciliar}
\label{t_tun_ha1}
\end{table}

% \subsubsection{Análise dos Tempos de Handover}
% 
% Na tabela \ref{t_handover}, encontram-se os tempos das fases do processo de
% \textit{handover} referentes ao cenário estudado.
% 
% Utilizando o cenário estudado como referência, foi realizado um teste que
% pretende verificar a perda na taxa de transmissão em um processo de
% \textit{handover}. Utilizando a ferramenta \textit{gen} que permite gerar
% tráfegos específicos e relatórios que extraem a taxa de trasmissão e a perda de
% pacotes, e utilizando o utilitário \textit{GNUPLOT} somos capazes de gerar
% gráficos que avaliam esse desempenho.
% 
% \begin{table}[!htpb]
% \centering
% \begin{small}
%   \setlength{\tabcolsep}{3pt}
% \begin{tabular}{|c|c|c|}\hline
% \textbf{Fase} & \textbf{Tempo (ms)} & \textbf{Media
% \%} \\ \hline
% \textit{TD} & 2240 & 48,6 \\ \hline
% \textit{TA} & 1320 & 28.63\\ \hline
% \textit{TR} & 1030 & 22.34\\ \hline
% \textit{TO} & 20 &  0.43\\ \hline
% \textit{TH} & 4610 & 100 \\ \hline
% \end{tabular} 
% \end{small}
% \caption{Latência no \textit{Handover} do cenário estudado}
% \label{t_handover}
% \end{table} 
% 
% Os testes realizados foram feitos utilizando tunelamento bidirecional, o tempo
% configurado para o intervalo entre as mensagens de \textit{Router Advertisement}
% foi de 30 à 70 milisegundos. Os comandos disparados nos nós móvel e
% correspondente foram os seguintes:
% \begin{verbatim}
% mn# gen -l -d -p udp -s 14000 -f /host/log/
% cn# gen -a 2000:a::1 -d -p udp -s 14000
% \end{verbatim}
% 
% O gráfico obtido no teste, pode ser observado na figura \ref{f_banda}.
% 
% \begin{figure}[!htpb]
% 	\centering
% 	\includegraphics[scale=.6]{figs/banda}
% 	\caption{Taxa de transmissão em \textit{Handover}}
% 	\label{f_banda}
% \end{figure}
% 
% A partir dos dados levantados com o teste podemos tirar várias conclusões, entre
% as quais destacam-se que o \textit{Troughput} suportado pela rede gira em torno
% de 9 Mbps, este dado esta muito relacionado ao desempenho da máquina hospedeiro,
% que cada \textit{handover} é de aproximadamente 3 segundos, há perdas
% consideráveis de pacotes que prejudicariam muito comunicações interativas como
% videoconferência e \textit{VoIP}, porém, navegação em paginas da
% \textit{Internet} e visualização de \textit{e-mail} a instabilidade é tolerável.
% 
% Como cenário estudo foi simulado todos os tempos medidos são estimados. Porém,
% segundo algumas bibliografias estudadas que realizaram experimentos fisicamente
% os tempos medidos na simulação estão dentro do esperado.
% 
% É perceptível que as fases que mais comprometem o \textit{handover} do nosso
% cenário são as da detecção de movimento e a configuração do
% \textit{care-of-address}. Algumas tentativas podem ser feitas para tentar
% diminuir a latência nestas duas fases.
% 
% Na tentativa de diminuir o tempo da fase de detecção de movimento, podemos
% diminuir o intervalo entre as mensagens de \textit{Router Advertisement} do
% roteador presente na rede que irá ser visitada pelo nó móvel. Pois, é por meio
% desta mensagem que o nó móvel detecta o movimento e desencadeia todo o processo
% de \textit{handover}.
% 
% No intuito de verificar se há uma melhora no processo de handover. O cenário
% estudado foi repetido variando o intervalo entre as mensagens de \textit{Router
% Advertisement}. O resultado deste teste esta disponível na figura \ref{f_radvd}.
% 
% \begin{figure}[!htpb]
% 	\centering
% 	\includegraphics[scale=.6]{figs/radvd}
% 	\caption{Diferentes intervalos entre as mensagens \textit{Router
% Advertisement}}
% 	\label{f_radvd}
% \end{figure}
% 
% Com os dados levantados, é possível perceber que o intervalo entre as mensagens
% de \textit{Router Advertisement} esta diretamente ligado com a perda de pacotes
% durante o \textit{handover}. Porém, esta não é uma boa prática para tentar
% amenizar a latência do handover, pois um numero muito grande de mensagens
% \textit{multicasting} inundaria a rede prejudicando a perfomance principalmente
% em redes sem fio.
% 
% No processo de formação de um novo \textit{care-of-address} o DAD é necessário
% para se certificar que o endereço formado é exclusivo. Para o teste ser bem
% sucedido nenhum nó vizinho deve enviar um \textit{Neighbor Advertisement}, em
% resposta ao teste, ou \textit{Neighbor Solicitation}, como o mesmo endereço em
% questão, em um período de \textit{1000ms} segundo a RFC 2462 \cite{rfc2462}.
% Este tempo de espera compromete a fase de configuração do
% \textit{care-of-address}.
% 
% Existe uma variável chamada \textit{dad\_transmits} no kernel do Linux que é
% usada para configurar o DAD em um nó. Com a intenção de diminuir a latência na
% fase de configuração do \textit{care-of-address}, nós configuramos a variável
% com o valor 0, isso significa que o procedimento de DAD é cancelado, e repetimos
% o cenário estudado.

%===========================================================================
\subsection{Variação 2: MIPv6 com Otimização de Rota}

\subsubsection{Análise da Troca de Mensagens}

\begin{table}[!htpb]
\centering
\begin{footnotesize}
  \setlength{\tabcolsep}{3pt}
\begin{tabular}{|c|c|c|c||}\hline \hline
\textbf{Tempo (s)} & \textbf{Origem} &
\textbf{Destino} & \textbf{Conteúdo}\\ \hline \hline
50:21.991721 & 2000:a::1 & 2000:c::1 & ICMP6, echo reply \\ \hline
\textbf{50:24.231519} & \textbf{fe80::b04c:e9ff:feec:6c42} & \textbf{ff02::1} &
\textbf{Router Advertisement}\\
50:24.247992 & :: & ff02::16 & HBH, multicast listener\\
50:24.545598 & :: & ff02::1:ffd5:efea & NS, who 2000:d::9009:4fff:fed5:efea\\ 
50:24.879467 & :: & ff02::1:ffd5:efea & NS, who fe80::9009:4fff:fed5:efea\\
50:25.548165 & fe80::b04c:e9ff:feec:6c42 & ff02::1 & Router Advertisement\\
\textbf{50:25.557223} & \textbf{2000:d::9009:4fff:fed5:efea} &
\textbf{2000:a::2} & \textbf{BU seq\#=47808 AH}\\
50:25.576407 & :: & ff02::16 & HBH, multicast listener\\
50:26.581135 & fe80::b04c:e9ff:feec:6c42 & ff02::1:ffd5:efea & NS, who
2000:d::9009:4fff:fed5:efea\\
50:26.581276 & 2000:d::9009:4fff:fed5:efea & fe80::b04c:e9ff:feec:6c42 &
Neighbor Advertisement\\
\textbf{50:26.581588} & \textbf{2000:a::2} &
\textbf{2000:d::9009:4fff:fed5:efea} & \textbf{BA seq\#=47808 lifetime=262140}\\
\hline
50:26.987535 & fe80::9009:4fff:fed5:efea & fe80::ac4d:a8ff:fe10:eb1d & NS, who
fe80::ac4d:a8ff:fe10:eb1d\\
50:27.009344 & 2000:a::2 & 2000:d::9009:4fff:fed5:efea & 2000:c::1 > 2000:a::1,
(icmp6)\\
50:27.009538 & 2000:d::9009:4fff:fed5:efea & 2000:a::2 & 2000:a::1 >
2000:c::1,(icmp6)\\
\textbf{50:27.013543} & \textbf{2000:d::9009:4fff:fed5:efea} &
\textbf{2000:a::2} & \textbf{2000:a::1 > 2000:c::1,(HoTI)}\\
\textbf{50:27.015165} & \textbf{2000:d::9009:4fff:fed5:efe} & \textbf{2000:c::1}
& \textbf{CoTI Care-of Init}\\
\textbf{50:27.019919} & \textbf{2000:a::2} &
\textbf{2000:d::9009:4fff:fed5:efea} & \textbf{2000:c::1 > 2000:a::1, (HoT)}\\
\textbf{50:27.029192} & \textbf{2000:c::1} &
\textbf{2000:d::9009:4fff:fed5:efea} & \textbf{CoT}\\
\textbf{50:27.031650} & \textbf{2000:d::9009:4fff:fed5:efea} &
\textbf{2000:c::1} & \textbf{BU seq\#=1077 A}\\
\textbf{50:27.037401} & \textbf{2000:c::1} &
\textbf{2000:d::9009:4fff:fed5:efea} & \textbf{BA seq\#=1077 lifetime=420}\\
50:27.365152 & fe80::b04c:e9ff:feec:6c42 & ff02::1 & Router Advertisement\\
50:27.982719 & fe80::9009:4fff:fed5:efea & fe80::ac4d:a8ff:fe10:eb1d & Neighbor
Solicitation\\
50:28.014358 & 2000:c::1 & 2000:d::9009:4fff:fed5:efea & ICMP6, echo request\\
50:28.014494 & 2000:d::9009:4fff:fed5:efea & 2000:c::1 & ICMP6, echo reply \\
\hline
\end{tabular} 
 \end{footnotesize}
\caption{Mensagens do Cenário 1 com Otimização de Roteamento}
\label{t_mes_ro}
\end{table} 

\subsubsection{Estado das Tabelas de Roteamento e de Regras}

\subsubsection{Detalhes da Formação de Túneis}

\subsubsection{Análise de Tempos de Handover}

%=========================================================================

\section{Cenário 2 - Uso do Protocolo HMIPv6}
\label{s_cenario2}

\subsection{Descrição da Topologia}

\begin{figure}[!htpb]
	\centering
	\includegraphics[scale=.3]{figs/cenario2}
	\caption{Topologia do Cenário 2}
 	\label{f_cenario2}
\end{figure}

\subsection{Análise da Troca de Mensagens}

\subsection{Estado das Tabelas de Roteamento e de Regras}

\subsection{Detalhes da Formação de Túneis}

\subsection{Análise de Tempos de Handover}


\section{Conclusões sobre a Análise dos Cenários}

Com a realização dos experimentos podemos constatar o funcionamento do protocolo
e perceber continuação da comunicação entre os pontos comunicantes após a
mobilidade de forma transparente as camadas superiores a de rede, observar todas
as mensagens trocadas no processo e estimar o tempo de latência com a
mobilidade.
O primeiro resultado que se pode obter com a realização do Cenário 1, foi o
perfeito funcionamento do MIPv6, ocorreram algumas perdas de pacotes, mas o nó
móvel conseguiu continuar sendo alcançado pelo seu endereço domiciliar mesmo não
estando em sua rede domiciliar.