% ----------------------------------------------------------------------- %
% Arquivo: ipv6.tex
% ----------------------------------------------------------------------- %
\chapter{IPv6}
\label{c_anexo_ipv6}
Considerando o grande crescimento da \textit{Internet}, o protocolo que é
utilizado hoje, o \acf{IPv4}, é considerado incapaz de suprir a necessidade da
demanda por novos endereços na \textit{Internet}.

A previsão atual para a exaustão de todos os endereços IPv4 livres é Março 2011
\cite{ipv4}, o que significa que o uso do \acf{IPv6} é inevitável num futuro
próximo.

Com o intuito de resolver o problema de números de endereço e as principais
falhas encontradas no IPv4, foi proposto o protocolo IPv6. As principais
melhorias são:

\begin{itemize}
	\item  Ampliação do Espaço de Endereçamento de 32 bits para 128 bits;
	\item  Melhoria na estrutura (formato) do pacote IP;
	\item  Melhoria no processo de autoconfiguração;
	\item  Inserção de mecanismos para tratamento de mobilidade, segurança e
facilidades para o gerenciamento de \ac{QoS}.
\end{itemize}

\section{A estrutura de cabeçalhos}

Um datagrama IPv6 é constituído por um cabeçalho base de tamanho fixo de 40
bytes, seguido de zero ou mais cabeçalhos de extensão. Na figura \ref{f_ipv6}, é
ilustrado um cabeçalho IPv6 com um cabeçalho de extenção de mobilidade.
\begin{figure}[!htpb]
	\centering
	\includegraphics[scale=1]{figs/ipv6}
	\label{f_ipv6}
	\caption{Estrutura do Cabeçalho do IPv6}
\end{figure}

O fato do cabeçalho IPv6 possuir um tamanho fixo é uma vantagem, pois acelera o
processamento dos pacotes nos roteadores, uma vez que não há necessidade de
calcular o tamanho de alguns campos e do cabeçalho como um todo.

A redução do números de campos utilizados, excluindo os campos com pouca
utilidade prática, também contribui para a diminuição do tempo gasto em
processamento pelos roteadores. Entre eles, dois que merecem destaque,
\textit{checksum} e o de fragmentação.

A função do campo de \textit{checksum} era detectar erros que afetassem ao
cabeçalho IP, não detectando no entanto erros no restante do pacote. Hoje os
mecanismos de deteção de erros Ethernet e PPP são bastante eficientes, o que
permitiu a exclusão do campo \textit{checksum}. Com isso os roteadores não
precisam recalcular o \textit{checksum} a cada salto, melhorando a sua
performace.

Quanto ao campo fragmentação, este foi excluído, pois decidiu-se que pacotes não
serão mais fragmentados por roteadores. Caso algum roteador da rota detecte que
o pacote é muito grande para o \ac{MTU} então ele avisa o nó fonte com ICMPv6
\textit{Packet Too Big}, que inclui o tamanho da MTU do enlace problema.

Desta forma há um ganho de performance no roteamento, pois é eliminada a
necessidade de um roteador fragmentar vários pacotes.
 
\section{O endereçamento IPv6}
O endereçamento no IPv6 passa a ser de 128 bits, incluindo o prefixo de rede e
sufixo do host. Não existem classes de endereços, como acontecia no IPv4.

Os endereços IPv6 são representados normalmente como oito grupos de 4 dígitos
hexadecimais. Por exemplo:
\begin{verbatim}
   3ffe:88a6:3a58:3d8a:021e:8cff:fe91:f6dd
\end{verbatim}
Se um grupo de dígitos for zeros, eles pode ser omitido. Por exemplo: 
\begin{verbatim}
   3ffe:88a6:3a58:0000:0000:0000:0000:f6dd 
\end{verbatim}
é o mesmo endereço IPv6 que: 
\begin{verbatim}
   3ffe:88a6:3a58::f6dd
\end{verbatim}
No IPv6 existem três tipos de endereços:
\begin{itemize}
 \item \textit{unicast} - cada endereço identifica uma interface (dispositivo).
 \item \textit{multicast} - cada endereço identifica múltiplas interfaces. É
enviada uma cópia para cada interface. O IPv6 eliminou o \textit{broadcast} e
enriqueceu o processo de \textit{multicast};
 \item \textit{anycast} - cada endereço pode ser atribuído a múltiplas
interfaces. Um datagrama é enviado para um dos dispositivos, por exemplo, o mais
próximo.
\end{itemize}

\section{ICMPv6}

O \acf{ICMPv6} \cite{rfc4443} permite enviar mensagens de erro e informação.

Em comparação ao \acf{ICMPv4}, podedos citar dentro das principais mudanças para
o ICMPv6 a incorporação da função de converter o endereço IP em endereço físico,
função que no IPv4 era feita por um protocolo a parte, o \ac{ARP} \cite{rfc826}.

As mensagens de descoberta de informações de vizinhança \acf{ND},
podem ser usadas para desempenhar a função equivalente ao ARP/RARP, para
detecção de IP duplicado \acf{DAD}, fazer anúncio ou solitação de roteadores e
outros.

O protocolo \ac{IGMP} que trata o multicast também foi incorporado no ICMPv6.

No \ac{MIP}, para fazer os registro de localização, também é utilizado
as mensagens ICMP.

\section{Autoconfiguração}

A autoconfiguração é um dos pontos fortes do IPv6. Ela viza liberar o usuário da
tarefa de configuração, tornando-a automática e transparente.
Ela pode ser feita por \textit{stateful autoconfiguration}, onde o endereço e
outros parâmetros de configuração são providos diretamente de um servidor, por
exemplo, os mecanismos \acf{DHCPv6} e \acf{PPPv6}. Ou pode ser feita por por
\textit{stateless autoconfiguration} \cite{rfc2462}, no qual o endereço é gerado
combinando os prefixos divulgados pelos roteadores e o \ac{MAC} do nó.
