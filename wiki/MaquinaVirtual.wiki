#summary Maquina Virtual com suporte ao MIPv6
#labels uml,kernel,mipl,radvd

= Introdução =

Devido a facilidade, rapidez para construção de ambientes de testes de rede este projeto fará o uso de máquinas virtuais. Será utilizado a máquina virtual UML (_User Mode Linux_) que é incorporada ao kernel e apresenta um alto desempenho em execução.

Nesta documentação também será abordado a compilação do kernel com suporte ao MIPv6, a instalação do MIPL (_Mobile IPv6 for Linux_) uma implementação do IPv6 Móvel para o Linux, e a instalação do RADVD (_Router ADVertisement Daemon_) necessário em redes IPv6 para gerar _router advertisement_ e escutar _router solicitations_.

= UML =

O uso das máquinas virtuais UML é muito fácil, simplesmente é necessário um kernel compilado  para este tipo especifico de arquitetura e um _filesystem_.

Para os testes será utilizado um _filesytem_ baseado no [http://wiki.n3network.ch/index.php/N3_Virtual_Linux_Router N3 Virtual Linux Router], é um  pequeno e mínimo _filesystem_ com vários utilitários de rede e é dedicado a testes de roteamento. Está disponível para download em http://projfin-hmip.code.google.com/files/n3vlr-0.11-mipv6.img . Obs: Não concluida ainda.

Existe um pacote chamado _uml utilities_, que possui várias ferramentas que serão utilizadas no ambiente de testes. Faça o download e instale o pacote:

{{{ 
# wget http://prdownloads.sourceforge.net/user-mode-linux/uml_utilities_20040406.tar.bz2
# tar jxvf uml_utilities_20040406.tar.bz2 && cd cd tools-20040406
# make && make install 
}}}


Para mais informações acesse [http://user-mode-linux.sourceforge.net User-mode Linux Kernel Home Page].

= KERNEL =

Para este ambiente de testes será utilizado a versão 2.6.22.2 do kernel. Então faça o download dos códigos fontes do kernel:

{{{
# wget http://kernel.org/pub/linux/kernel/v2.6/linux-2.6.22.2.tar.bz2
# tar jxvf linux-2.6.22.2.tar.bz2
# cd linux-2.6.22.2
}}}

Como o ambiente de testes será utilizando máquinas virtuais devemos compilar o kernel para essa arquitetura:

{{{
#  export ARCH=um
}}} 

Configurando kernel:

{{{
# make defconfig
# make menuconfig
}}}

No menu _UML-specific options_ é interessante selecionar esta opção _Host filesystem_ para as maquinas virtuais terem acesso ao filesystem do host.

Para configurar o kernel com suporte ao MIPv6, no menu _Networking ---> Networking options_ selecione as opções: _*Transformation user configuration interface*_, _*PF_KEY sockets*_, _*PF_KEY MIGRATE*_, _*IP: ARP daemon support*_, _*The IPv6 protocol*_, _*IPv6: ESP transformation*_, _*IPv6: Mobility*_, _*IPv6: MIPv6 route optimization mode*_, _*IPv6: Multiple Routing Tables*_, _*IPv6: source address based routing*_.

Para verificar se o kernel está configurado corretamente para ter suporte ao MIPv6 existe um shell script _*chkconf_kernel.sh*_ que acompanha o pacote do MIPL.

Pelo menos estas opções devem estar setadas, no arquivo .config:

{{{
CONFIG_EXPERIMENTAL=y
CONFIG_SYSVIPC=y
CONFIG_PROC_FS=y
CONFIG_NET=y
CONFIG_INET=y 
CONFIG_IPV6=y
CONFIG_IPV6_MIP6=y
CONFIG_XFRM=y
CONFIG_XFRM_USER=y
}}}

O _home agent_ e o nó móvel precisam:
{{{
CONFIG_IPV6_TUNNEL=y
CONFIG_IPV6_MULTIPLE_TABLES=y
}}}

O nó móvel também precisa:
{{{
CONFIG_IPV6_SUBTREES=y
}}}

Para alguns indicadores de movimento do nó móvel, pode ser setado:
{{{
CONFIG_ARPD=y
}}}

Para suporte ao IPsec é necessário pelo menos:
{{{
CONFIG_INET6_ESP=y
}}}

Para utilizar IPsec nos túneis:
{{{
CONFIG_NET_KEY=y
CONFIG_NET_KEY_MIGRATE=y
}}} 

Após configurado o kernel deve ser compilado, os seus módulos serão instalados no diretório uml-modules para depois serem copiados para o _filesystem_ da máquina virtual.
{{{
# make
# strip linux
# make modules_install INSTALL_MOD_PATH=uml-modules
# unset arch
}}}

= MIPL =

a fazer.

= RADVD =

a fazer.